--- 
version: 0.3

plan:
  steps: 
    - type: checkout
      name: "PRæµ‹è¯•ğŸ‘¦"

    - type: opaScan
      name: OPA Scan
      
    - type: command
      name: "è¯´ä¸¤å¥"
      args: 
        - "echo \"Try it\""

    - type: terraformInit
      name: "Terraform Init"
      
    - type: terraformPlan
      name: "Terraform Plan"

    - type: command
      args: 
        - "echo \"get somethings\""
        - "bash script.sh"
#        - "curl 127.0.0.1/api/action"



apply: 
  onFail: 
    type: command
    args: 
      - echo "Job failedâŒ"

  onSuccess: 
    type: command
    args: 
      - echo "Job successfulâœ…"

  steps: 
    - type: command
      name: "è¶…æ—¶æµ‹è¯•âŒšï¸"
      args: 
        - echo "æˆ‘æ¥äº†,Goï½ï½ğŸƒ31sâ€â™€ï¸"
        - sleep 31s
        - echo "biAjiï½ï½ğŸƒâ€â™€ï¸"

    - type: checkout
      name: "1âƒ£ï¸Checkout code"

    - type: terraformInit
      name: "2âƒ£ï¸Terraform Init"

    - type: opaScan
      name: 3âƒ£ï¸OPA Scan

    - type: terraformPlan
      name: "4âƒ£ï¸Terraform Plan"

    - type: terraformApply
      name: "ğŸˆšï¸Terraform Apply"

    - type: ansiblePlay
      name: "ğŸ¦ŒRun playbook"



destroy: 
  steps: 
    - type: checkout
      name: "ç«æ˜Ÿæ–‡ğŸŒŸ"

    - type: terraformInit
      name: "Terraform Init"

    - type: terraformPlan
      name: "Terraform Plan"
      args: 
        - "-destroy"

    - type: terraformDestroy
      name: "Terraform Destroy"

    - type: command
      name: "Say Bye"
      args: 
        - echo "Bye!ğŸ‘‹"
